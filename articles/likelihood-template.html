<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="FishSET">
<title>Create your own likelihood function • FishSET</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Create your own likelihood function">
<meta property="og:description" content="FishSET">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">FishSET</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/FishSET_FunctionList.html">FishSET R package functions</a>
    <a class="dropdown-item" href="../articles/FishSET_GUI_Quickstart_Guide.html">FishSET GUI Quickstart Guide</a>
    <a class="dropdown-item" href="../articles/likelihood-template.html">Create your own likelihood function</a>
    <a class="dropdown-item" href="../articles/making_a_spatial_grid.html">Making a spatial grid file</a>
    <a class="dropdown-item" href="../articles/scallop-example.html">Scallop Example</a>
    <a class="dropdown-item" href="../articles/scallop-mod-example.html">Scallop Conditional Logit Model Example</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/noaa-nwfsc/FishSET/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Create your own likelihood function</h1>
                        <h4 data-toc-skip class="author">Paul
Carvalho</h4>
            
            <h4 data-toc-skip class="date">2024-11-13</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/noaa-nwfsc/FishSET/blob/HEAD/vignettes/likelihood-template.Rmd" class="external-link"><code>vignettes/likelihood-template.Rmd</code></a></small>
      <div class="d-none name"><code>likelihood-template.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The FishSET R package currently features six statistical functions
for maximum likelihood estimation, detailed in section 8.3 of the <a href="https://noaa-nwfsc.github.io/FishSET/articles/FishSET_User_Manual.html" class="external-link">user
manual</a>. These functions offer a solid foundation for a variety of
analyses. However, we recognize that these built-in functions may not
suit your specific modeling needs. We encourage users with more
specialized modeling requirements to develop their own likelihood
functions that can be integrated into the FishSET R package. By doing
so, users will not only be able to take advantage of other FishSET
features such as policy simulation tools but also contribute to a richer
toolkit for the FishSET user community.</p>
<p>Here we provide a template for developing a likelihood function that
can be seamlessly integrated into the FishSET package. Feel free to
reach out to our team at <a href="mailto:nmfs@fishset.gov">nmfs.fishset@noaa.gov</a> with any
questions about developing your own likelihood function.</p>
</div>
<div class="section level2">
<h2 id="development-guidelines">Development guidelines<a class="anchor" aria-label="anchor" href="#development-guidelines"></a>
</h2>
<ol style="list-style-type: decimal">
<li><p>Fork the <a href="https://github.com/noaa-nwfsc/FishSET" class="external-link">FishSET
repo</a> and clone the forked repository to your computer. More
information on “forking” repositories and the GitHub workflow can be
found <a href="https://git-scm.com/book/en/v2/GitHub-Contributing-to-a-Project" class="external-link">here</a>.</p></li>
<li><p>Open the FishSET_RPackage.Rproj file.</p></li>
<li><p>Create a new script for your likelihood function following the
template below. Save it in the <code>R</code> folder.</p></li>
<li><p>Commit and push changes.</p></li>
<li><p>Review and test code.</p></li>
<li><p>If you have gone through the steps above but it has been a while
since you worked on the code, pull changes from the original FishSET
repo to your clone.</p></li>
<li><p>Submit a <a href="https://docs.github.com/en/get-started/exploring-projects-on-github/contributing-to-a-project#making-a-pull-request" class="external-link">pull
request</a>.</p></li>
</ol>
</div>
<div class="section level2">
<h2 id="create-a-likelihood-function">Create a likelihood function<a class="anchor" aria-label="anchor" href="#create-a-likelihood-function"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>likelihood_function <span class="ot">&lt;-</span> <span class="cf">function</span>(starts3, dat, otherdat, alts, project, expname, mod.name) {</span></code></pre></div>
<p>Give your likelihood function an informative name (replace
<code>likelihood_function</code> in the code chunk above) and save the
script with the same name. Only include code for the likelihood function
in the R script.</p>
<p>The names and order of input arguments must match the code above.
These inputs are created within the <a href="https://noaa-nwfsc.github.io/FishSET/reference/make_model_design.html" class="external-link"><code>make_model_design()</code></a>
and <a href="https://noaa-nwfsc.github.io/FishSET/reference/discretefish_subroutine.html" class="external-link"><code>discretefish_subroutine()</code></a>
functions and described in detail below.</p>
<div class="section level3">
<h3 id="input-arguments">Input arguments<a class="anchor" aria-label="anchor" href="#input-arguments"></a>
</h3>
<ul>
<li><p><strong>starts3</strong>: Numeric vector that contains starting
parameter values. The length and order of parameter values will depend
on your model structure. For example, the order of <code>starts3</code>
for the <a href="https://noaa-nwfsc.github.io/FishSET/reference/logit_c.html" class="external-link">conditional
logit model</a> is
<code>c([alternative-specific parameters], [travel-distance parameters])</code>,
and the length of each depends on the number of variables included in
the <a href="https://noaa-nwfsc.github.io/FishSET/reference/make_model_design.html" class="external-link">model
design</a>.</p></li>
<li><p><strong>dat</strong>: Numeric matrix that is generated in the
<code><a href="../reference/shift_sort_x.html">shift_sort_x()</a></code> function. The first column contains catch
(thus rows represent observations); the second column indicates the zone
fished; columns 3 to the square of alternatives + 2 (example, if there
are 4 alternatives/zones, then columns 3-18) contains a flattened
identity matrix that has been shifted and sorted such that the zone
selected is moved to the first column position of the matrix (see
example below); and the last x columns, where x equals the number of
alternatives/zones, contains distances from the starting location to
each alternative (distances have also been shifted such that the
distance to the zone selected is first - see example below).</p></li>
</ul>
<div class="line-block">          Here is an example row from a
<code>dat</code> matrix:.</div>
<p><span class="math display">\[\begin{bmatrix}
17&amp;2&amp;0&amp;0&amp;1&amp;1&amp;0&amp;0&amp;0&amp;1&amp;0&amp;5&amp;10&amp;15
\\
\end{bmatrix}\]</span></p>
<div class="line-block">          This row indicates that the catch is
<strong>17</strong>, from zone <strong>2</strong>, and the shifted,
flattened matrix can be rewritten as:</div>
<p><span class="math display">\[\begin{bmatrix}
0&amp;0&amp;1 \\
1&amp;0&amp;0 \\
0&amp;1&amp;0 \\
\end{bmatrix}\]</span></p>
<div class="line-block">          where the columns of the identity
matrix have been shifted such that the second column is now in the
first<br>
          position (because zone 2 was fished), followed by 3 and 1.
Finally, the distances from the starting location<br>
          to zones 2, 3, and 1 are 5, 10, and 15, repectively.</div>
<p><br></p>
<ul>
<li><p><strong>otherdat</strong>: A list that contains variables used in
the model. For example, <code>otherdat</code> for conditional logit
models contains <code>intdat</code> variables (as a list object) that
interact with travel distance and <code>griddat</code> variables (as a
list object) that vary across alternatives. The <code>otherdat</code>
list is generated in the <a href="https://noaa-nwfsc.github.io/FishSET/reference/make_model_design.html" class="external-link"><code>make_model_design()</code></a>
function. If your input variables are not compatible with the current
version of <code><a href="../reference/make_model_design.html">make_model_design()</a></code>, reach out to our team at <a href="mailto:nmfs.fishset@noaa.gov">nmfs.fishset@noaa.gov</a> and we
will do our best to update the function to accommodate your modeling
requirements.</p></li>
<li><p><strong>alts</strong>: Integer representing the total number of
zones included in the model.</p></li>
<li><p><strong>project</strong>: Name of project.</p></li>
<li><p><strong>expname</strong>: Name of expected catch table(s). This
input is used for conditional logit models.</p></li>
<li><p><strong>mod.name</strong>: Name of the model, which is designated
in the <code><a href="../reference/make_model_design.html">make_model_design()</a></code> function.</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="function-body">Function body<a class="anchor" aria-label="anchor" href="#function-body"></a>
</h3>
<p>Use base R functions to calculate the negative log-likelihood (nll)
and comprehensively document code.</p>
<p>Save the nll value to a variable named <code>ld</code>, and insert
the following code at then end of your function to log inputs and
outputs of the function call:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.nan</a></span><span class="op">(</span><span class="va">ld</span><span class="op">)</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">ld</span> <span class="op">&lt;-</span> <span class="va">.Machine</span><span class="op">$</span><span class="va">double.xmax</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">ldsumglobalcheck</span> <span class="op">&lt;-</span> <span class="va">ld</span></span>
<span>  <span class="va">paramsglobalcheck</span> <span class="op">&lt;-</span> <span class="va">starts3</span></span>
<span>  <span class="va">LDGlobalCheck</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">ldchoice</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">LDGlobalCheck</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">project</span>, <span class="va">expname</span>, <span class="va">mod.name</span><span class="op">)</span>, </span>
<span>                        ldsumglobalcheck <span class="op">=</span> <span class="va">ldsumglobalcheck</span>, </span>
<span>                        paramsglobalcheck <span class="op">=</span> <span class="va">paramsglobalcheck</span>, </span>
<span>                        LDGlobalCheck <span class="op">=</span> <span class="va">LDGlobalCheck</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">pos</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>  <span class="va">envir</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.environment.html" class="external-link">as.environment</a></span><span class="op">(</span><span class="va">pos</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/assign.html" class="external-link">assign</a></span><span class="op">(</span><span class="st">"LDGlobalCheck"</span>, value <span class="op">=</span> <span class="va">LDGlobalCheck</span>, envir <span class="op">=</span> <span class="va">envir</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">ld</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="integrating-your-function-with-fishset">Integrating your function with FishSET<a class="anchor" aria-label="anchor" href="#integrating-your-function-with-fishset"></a>
</h2>
<div class="section level3">
<h3 id="review-code-and-test-function">Review code and test function<a class="anchor" aria-label="anchor" href="#review-code-and-test-function"></a>
</h3>
<p>Before submitting a Pull Request, we ask contributors to thoroughly
review code and test likelihood functions (ideally on multiple datasets
if possible). Also, verify that the function is well-documented and
remove unnecessary or redundant code that might have been left behind
during development. Please reach out to the FishSET team (<a href="mailto:nmfs@fishset.gov">nmfs.fishset@noaa.gov</a>) if any
questions come up during the review and testing process.</p>
</div>
<div class="section level3">
<h3 id="create-a-pull-request">Create a pull request<a class="anchor" aria-label="anchor" href="#create-a-pull-request"></a>
</h3>
<p>Give the Pull Request the same name as the likelihood function you
just created and provide a brief description. Once the FishSET team
receives the Pull Request we will do our best to review the function in
a timely manner and notify you if we merge it with the main package or
request any changes to the function prior to merging.</p>
<p>The Pull Request for your likelihood function should not change any
other code in the FishSET package. If changes to the package outside of
your function are necessary, please contact the FishSET development team
(<a href="mailto:nmfs@fishset.gov">nmfs.fishset@noaa.gov</a>) to resolve
any issues.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Lisa Pfeiffer, Paul G Carvalho, Anna Abelman, Min-Yang Lee, Melanie Harsch, Bryce McManus, Alan Haynie.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
